# Data Model: Integrated RAG Chatbot for Physical AI & Humanoid Robotics Textbook

## Core Entities

### Question
- **Description**: A query from the user that requires a response based on textbook content
- **Fields**:
  - `id`: Unique identifier for the question
  - `content`: The text of the user's question
  - `user_id`: Identifier for the user (optional, for session tracking)
  - `session_id`: Identifier for the chat session
  - `timestamp`: When the question was submitted
  - `source_page`: The textbook page/chapter where the question originated
  - `selected_text`: Optional text that the user selected when asking the question

### Response
- **Description**: An answer generated by the system based on retrieved textbook content
- **Fields**:
  - `id`: Unique identifier for the response
  - `content`: The text of the response
  - `question_id`: Reference to the associated question
  - `confidence_score`: Confidence level of the response (0.0-1.0)
  - `citations`: List of source documents/chunks used to generate the response
  - `timestamp`: When the response was generated
  - `mode`: The mode used to generate the response ("full_textbook" or "selected_text_only")

### TextbookContent
- **Description**: Indexed chapters and sections from the Physical AI & Humanoid Robotics textbook
- **Fields**:
  - `id`: Unique identifier for the content chunk
  - `content`: The text content of the chunk
  - `title`: Title of the section/chapter
  - `chapter`: The chapter number or identifier
  - `section`: The section identifier
  - `source_file`: Original source file path
  - `embedding`: Vector embedding of the content
  - `metadata`: Additional metadata (word count, complexity, etc.)
  - `created_at`: When the content was indexed

### UserSession
- **Description**: A session tracking user interactions with the chatbot
- **Fields**:
  - `id`: Unique identifier for the session
  - `user_id`: Identifier for the user (optional)
  - `start_time`: When the session started
  - `end_time`: When the session ended (null if active)
  - `page_history`: List of pages visited during the session
  - `mode_preference`: Preferred mode ("full_textbook" or "selected_text_only")

### ChatHistory
- **Description**: A record of the conversation between user and chatbot
- **Fields**:
  - `id`: Unique identifier for the chat history entry
  - `session_id`: Reference to the user session
  - `question_id`: Reference to the question
  - `response_id`: Reference to the response
  - `timestamp`: When the interaction occurred
  - `feedback`: Optional user feedback on the response quality

## Relationships

- A `UserSession` contains many `ChatHistory` entries
- A `ChatHistory` entry links one `Question` to one `Response`
- A `Question` may reference a `TextbookContent` chunk through `selected_text`
- A `Response` may reference multiple `TextbookContent` chunks through `citations`

## Validation Rules

- `Question.content` must be between 10 and 500 characters
- `Response.content` must not exceed 2000 characters
- `TextbookContent.embedding` must be a valid vector representation
- `Response.mode` must be either "full_textbook" or "selected_text_only"
- `Response.citations` must only reference valid `TextbookContent` when in "selected_text_only" mode

## State Transitions

- `UserSession` starts in "active" state, transitions to "ended" when session concludes
- `Question` remains in "submitted" state after creation
- `Response` remains in "generated" state after creation