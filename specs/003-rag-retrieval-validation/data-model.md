# Data Model: RAG Retrieval Pipeline Validation & Testing

**Feature**: 003-rag-retrieval-validation
**Date**: December 25, 2025

## Entity: Query
**Description**: A text-based question or search request from a user that needs to be converted to embeddings for retrieval

**Fields**:
- `id` (string): Unique identifier for the query
- `text` (string): The actual query text
- `created_at` (datetime): Timestamp when query was created
- `embedding_request` (boolean): Whether embeddings should be generated for this query

**Validation rules**:
- Text must not be empty
- ID must be unique

## Entity: EmbeddingVector
**Description**: A numerical representation of text content generated by the Cohere model for semantic similarity matching

**Fields**:
- `id` (string): Unique identifier for the embedding vector
- `query_id` (string): Reference to parent Query
- `vector` (array of floats): The actual embedding vector values
- `vector_size` (integer): Dimension of the embedding vector
- `model_name` (string): Name of the model used to generate the embedding
- `created_at` (datetime): Timestamp when embedding was generated

**Validation rules**:
- Vector must have consistent dimensions based on the model
- Query_id must reference an existing Query
- Vector_size must match the expected size for the model

## Entity: RetrievedChunk
**Description**: A document chunk retrieved from the vector database as a result of a query

**Fields**:
- `id` (string): Unique identifier for the retrieved chunk
- `query_id` (string): Reference to the original Query
- `chunk_id` (string): Reference to the original document chunk in storage
- `content` (string): The actual text content of the chunk
- `similarity_score` (float): Cosine similarity score between query and chunk
- `rank` (integer): Position in the ranked results list
- `source_url` (string): URL of the original document
- `document_id` (string): ID of the original document
- `created_at` (datetime): Timestamp when chunk was retrieved

**Validation rules**:
- Content must not be empty
- Query_id must reference an existing Query
- Chunk_id must reference an existing stored chunk
- Similarity_score must be between 0 and 1
- Rank must be positive

## Entity: ValidationResult
**Description**: The result of validating a retrieval operation

**Fields**:
- `id` (string): Unique identifier for the validation result
- `query_id` (string): Reference to the original Query
- `is_relevant` (boolean): Whether the retrieved content is semantically relevant
- `relevance_score` (float): Numerical relevance score
- `metadata_valid` (boolean): Whether metadata is preserved correctly
- `semantic_similarity` (float): Semantic similarity between query and result
- `retrieval_latency` (float): Time taken for retrieval in seconds
- `deterministic` (boolean): Whether results are consistent across runs
- `created_at` (datetime): Timestamp when validation was performed
- `validation_details` (string): Detailed information about the validation

**Validation rules**:
- Query_id must reference an existing Query
- Relevance_score must be between 0 and 1
- Retrieval_latency must be positive

## Entity: ValidationReport
**Description**: A comprehensive report summarizing the validation of multiple queries

**Fields**:
- `id` (string): Unique identifier for the validation report
- `report_name` (string): Name/description of the validation run
- `total_queries` (integer): Total number of queries tested
- `successful_retrievals` (integer): Number of successful retrievals
- `precision_score` (float): Overall precision score
- `average_latency` (float): Average retrieval latency
- `metadata_accuracy` (float): Accuracy of metadata preservation
- `determinism_score` (float): Consistency of results across runs
- `created_at` (datetime): Timestamp when report was generated
- `status` (enum): Validation run status (pending, running, completed, failed)

**Validation rules**:
- Total_queries must be positive
- Precision_score, average_latency, metadata_accuracy, and determinism_score must be between 0 and 1
- Status must be one of the defined enum values

## Relationships

- **Query** 1 → * **EmbeddingVector**: One query generates one embedding vector
- **Query** 1 → * **RetrievedChunk**: One query can retrieve multiple chunks
- **Query** 1 → 1 **ValidationResult**: One query produces one validation result
- **ValidationResult** * → 1 **ValidationReport**: Multiple validation results contribute to one report

## State Transitions

### ValidationReport Status Transitions
- `pending` → `running`: When validation process begins
- `running` → `completed`: When all queries in the report are processed
- `running` → `failed`: When a critical error occurs during validation